# Generated by Django 3.2.11 on 2022-02-08 10:02

import autoslug.fields
from django.db import migrations

from apps.core.utils import slugify

def set_slug(apps, schema_editor):
    Author = apps.get_model("library", "Author")
    qs = Author.objects.all()
    for author in qs:
        if author.slug == "someslug":
            baseslug = slugify(author.person.last_name)
            used = qs.values_list("slug", flat=True)
            if baseslug in used:
                baseslug += str(author.person.id)
            author.slug = baseslug
            author.save()


class Migration(migrations.Migration):

    dependencies = [
        ('library', '0003_auto_20220208_1214'),
    ]

    operations = [
        migrations.RunPython(
            set_slug,
        ),
        migrations.AlterField(
            model_name='author',
            name='slug',
            field=autoslug.fields.AutoSlugField(editable=False, unique=True, verbose_name='Слаг'),
        ),
    ]
